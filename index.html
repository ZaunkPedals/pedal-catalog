<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZAUNK! // PEDAL EFFECTS</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Courier+Prime:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-paper: #f4f4f4; /* Blanco roto */
      --ink: #111;         /* Tinta negra */
      --brand-blue: #253494; /* AZUL ZAUNK */
      --font-body: 'Courier Prime', monospace;
      --font-title: 'Anton', sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background-color: var(--bg-paper);
      /* Textura de ruido sutil */
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
      color: var(--ink);
      font-family: var(--font-body);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* TITULARES */
    h1, h2, h3 { 
      font-family: var(--font-title); 
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 0;
    }

    /* HEADER */
    header {
      padding: 2rem 1rem;
      text-align: center;
      border-bottom: 4px solid var(--brand-blue);
      background: #fff;
      position: relative;
    }
    
    .logo-container {
      display: inline-block;
      max-width: 250px;
      transform: rotate(-1deg);
      transition: transform 0.3s;
    }
    .logo-container:hover { transform: scale(1.05) rotate(1deg); }
    .logo-container img { width: 100%; height: auto; display: block; }

    /* LAYOUT & SECCIONES */
    .container { max-width: 1200px; margin: auto; padding: 0 1.5rem; }
    section { padding: 4rem 0; border-bottom: 2px dashed var(--ink); }
    
    .main-content { flex: 1; }

    /* BOTONES */
    .btn {
      background: #fff;
      color: var(--ink);
      border: 2px solid var(--ink);
      padding: 10px 20px;
      font-family: var(--font-title);
      font-size: 1.1rem;
      letter-spacing: 1px;
      cursor: pointer;
      box-shadow: 4px 4px 0px var(--ink);
      transition: transform 0.1s;
    }
    .btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--ink); }
    .btn:hover { background: var(--ink); color: #fff; }
    
    /* Botones de acento (Azules) */
    .btn-brand { 
      border-color: var(--brand-blue); 
      color: var(--brand-blue); 
      box-shadow: 4px 4px 0px var(--brand-blue); 
    }
    .btn-brand:hover { background: var(--brand-blue); color: #fff; }

    /* TARJETAS DE PEDALES */
    .grid-pedales {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 3rem;
    }
    
    .card {
      background: #fff;
      border: 2px solid var(--ink);
      padding: 15px;
      box-shadow: 8px 8px 0px rgba(37, 52, 148, 0.15); 
      transform: rotate(var(--rot, 0deg));
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }
    .card:hover {
      transform: scale(1.02) rotate(0deg) !important;
      box-shadow: 10px 10px 0px var(--brand-blue);
      z-index: 10;
      border-color: var(--brand-blue);
    }

    .card-img-wrapper {
      border: 2px solid var(--ink);
      margin-bottom: 1rem;
      filter: grayscale(100%) contrast(1.1);
      transition: filter 0.3s;
      height: 220px;
      overflow: hidden;
      cursor: pointer;
      background: #eee;
    }
    .card:hover .card-img-wrapper { filter: grayscale(0%); border-color: var(--brand-blue); }
    .card-img-wrapper img { width: 100%; height: 100%; object-fit: cover; }

    .card h3 { 
      font-size: 1.8rem; margin-bottom: 0.5rem; 
      border-bottom: 3px solid var(--brand-blue); 
      display: inline-block; cursor: pointer;
    }
    .card p { font-size: 0.9rem; line-height: 1.4; color: #333; }

    /* CHECKBOX MANUAL */
    .checkbox-wrapper {
      display: flex; align-items: center; gap: 10px; margin-top: 1rem;
      font-weight: bold; cursor: pointer; user-select: none;
    }
    .custom-check {
      width: 24px; height: 24px; border: 2px solid var(--ink);
      background: #fff; display: flex; align-items: center; justify-content: center;
    }
    input[type="checkbox"] { display: none; }
    input[type="checkbox"]:checked + .custom-check { background: var(--brand-blue); border-color: var(--brand-blue); }
    input[type="checkbox"]:checked + .custom-check::after {
      content: "✓"; font-family: var(--font-title); color: #fff; font-size: 1.2rem;
    }

    /* SOCIAL FOOTER - AZUL COMPLETO */
    .social-bar {
      background: var(--brand-blue);
      color: #fff;
      padding: 3rem 0;
      margin-top: 4rem;
      border-top: 4px solid var(--ink); /* Borde negro para contraste fanzine */
    }
    .social-links {
      display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;
    }
    .social-link {
      color: #fff; text-decoration: none; font-family: var(--font-title);
      font-size: 1.5rem; letter-spacing: 1px; border: 2px solid transparent;
      padding: 5px 15px; transition: 0.3s;
    }
    .social-link:hover {
      background: #fff; color: var(--brand-blue); border-color: #fff; transform: skew(-5deg);
    }

    /* MODAL */
    .modal {
      position: fixed; inset: 0; background: rgba(255,255,255,0.95);
      display: none; align-items: center; justify-content: center; z-index: 1000;
      background-image: radial-gradient(var(--brand-blue) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .modal-content {
      background: #fff; border: 4px solid var(--brand-blue);
      width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto;
      padding: 2rem; box-shadow: 15px 15px 0px var(--ink);
      position: relative;
    }
    .close-modal {
      position: absolute; top: 0; right: 0; background: var(--brand-blue); color: #fff;
      padding: 5px 15px; font-weight: bold; cursor: pointer; font-size: 1.5rem; font-family: var(--font-title);
    }
    .close-modal:hover { background: var(--ink); }

    .video-frame {
      width: 100%; aspect-ratio: 16/9; background: #000; border: 2px solid var(--ink); margin-top: 1rem;
    }

    /* BOTON FLOTANTE */
    #cart-fab {
      position: fixed; bottom: 2rem; right: 2rem;
      background: var(--brand-blue); color: #fff;
      padding: 1rem 2rem; font-family: var(--font-title); font-size: 1.2rem; letter-spacing: 1px;
      transform: rotate(-3deg); border: 2px solid #fff; box-shadow: 5px 5px 0px var(--ink);
      cursor: pointer; display: none; z-index: 100;
    }
    #cart-fab:hover { transform: scale(1.1) rotate(0deg); }

    /* ADMIN PANEL */
    #admin-panel {
      position: fixed; inset: 0; background: #e0e0e0; z-index: 2000;
      padding: 2rem; overflow-y: auto; display: none;
      font-family: monospace;
    }
    .admin-box { 
      background: #fff; border: 2px solid #000; padding: 1.5rem; 
      margin-bottom: 2rem; box-shadow: 8px 8px 0 var(--brand-blue); 
    }
    input, select, textarea {
      width: 100%; background: #f0f0f0; border: 1px solid #999; padding: 10px;
      font-family: monospace; margin-bottom: 12px; font-size: 0.9rem;
    }
    input:focus, textarea:focus { border-color: var(--brand-blue); outline: none; background: #fff; }
    
  </style>
</head>
<body>

<header>
  <div class="container">
    <div class="logo-container">
      <img src="img/Zaunk_Logo.png" alt="ZAUNK! Pedal Effects">
    </div>
  </div>
</header>

<div class="main-content">
  <section id="catalogo">
    <div class="container" id="pedal-container">
      <p style="text-align:center; font-size:1.5rem; padding: 2rem;">[ CARGANDO EFECTOS... ]</p>
    </div>
  </section>
</div>

<footer class="social-bar">
  <div class="container">
    <div style="text-align: center; margin-bottom: 1rem;">
      <h3 style="margin:0; color:#fff;">SÍGUENOS EN LA RED</h3>
    </div>
    <div class="social-links">
      <a href="https://instagram.com" target="_blank" class="social-link">INSTAGRAM</a>
      <a href="https://youtube.com" target="_blank" class="social-link">YOUTUBE</a>
      <a href="mailto:contacto@zaunk.com" class="social-link">EMAIL</a>
      <a href="#" target="_blank" class="social-link">TIKTOK</a>
    </div>
    <div style="text-align:center; margin-top: 2rem; opacity: 0.7; font-size: 0.8rem;">
      &copy; 2024 ZAUNK! PEDAL EFFECTS. HANDMADE NOISE.
    </div>
  </div>
</footer>

<div id="cart-fab" onclick="checkout()">
  <span id="cart-count">0</span> -> PEDIR AHORA
</div>

<div class="modal" id="product-modal">
  <div class="modal-content">
    <div class="close-modal" onclick="closeModal()">X CERRAR</div>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:2rem; margin-top: 1rem;">
      <div>
        <div id="modal-imgs" style="display:flex; flex-direction:column; gap:10px;"></div>
        <div id="modal-video-container"></div>
      </div>
      <div>
        <h2 id="modal-title" style="background:var(--brand-blue); color:#fff; display:inline-block; padding:5px 10px; transform: rotate(-1deg);">TITULO</h2>
        <h4 id="modal-cat" style="color:var(--ink); border: 2px solid var(--ink); display:inline-block; padding: 2px 5px; margin-top:0.5rem;">CATEGORIA</h4>
        <p id="modal-desc" style="white-space: pre-line; padding:1rem; border-left: 4px solid var(--brand-blue); background: #f9f9f9; margin-top: 1rem;"></p>
        <br>
        <button class="btn btn-brand" onclick="toggleSelectFromModal()">[ ] AÑADIR AL PEDIDO</button>
      </div>
    </div>
  </div>
</div>

<div id="admin-panel">
  <div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h1>// ZAUNK CONTROL PANEL</h1>
      <button class="btn" style="background:var(--ink); color:#fff;" onclick="closeAdmin()">X CERRAR PANEL</button>
    </div>

    <div class="admin-box" style="border-color: var(--brand-blue);">
      <h3 style="color:var(--brand-blue)">SEGURIDAD</h3>
      <p style="font-size:0.8rem">Genera un nuevo hash si quieres cambiar la contraseña en el código.</p>
      <div style="display:flex; gap:10px;">
        <input type="text" id="new-pass-input" placeholder="Nueva contraseña..." style="width:auto; flex:1;">
        <button class="btn" onclick="generateHashTool()">GENERAR HASH</button>
      </div>
      <div id="hash-result" style="background:#000; color:#0f0; padding:10px; margin-top:10px; display:none; font-family:monospace; word-break:break-all;"></div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:2rem;">
      <div class="admin-box">
        <h3>EDITOR DE ARTEFACTOS</h3>
        <input type="hidden" id="admin-id">
        
        <label><strong>Nombre del Pedal:</strong></label>
        <input type="text" id="admin-nombre">
        
        <label><strong>Categoría:</strong></label>
        <select id="admin-categoria">
          <option value="fuzz">FUZZ</option>
          <option value="overdrive">OVERDRIVE</option>
          <option value="distorsion">DISTORSION</option>
          <option value="modulacion">MODULACION</option>
          <option value="bajo">BAJO</option>
          <option value="otros">OTROS</option>
        </select>
        
        <label><strong>Imágenes (URLs):</strong> <small>Una URL por línea</small></label>
        <textarea id="admin-imgs-text" rows="4" placeholder="https://ejemplo.com/foto1.jpg&#10;https://ejemplo.com/foto2.jpg"></textarea>
        
        <label><strong>ID Video Youtube:</strong> (Ej: dQw4w9WgXcQ)</label>
        <input type="text" id="admin-video">
        
        <label><strong>Descripción Corta:</strong></label>
        <textarea id="admin-short" rows="2"></textarea>
        
        <label><strong>Descripción Técnica Completa:</strong></label>
        <textarea id="admin-long" rows="6"></textarea>
        
        <div style="display:flex; gap:10px; margin-top:1rem;">
          <button class="btn btn-brand" style="flex:1;" onclick="savePedal()">GUARDAR</button>
          <button class="btn" onclick="clearForm()">LIMPIAR</button>
        </div>
      </div>

      <div class="admin-box">
        <h3>INVENTARIO ACTUAL</h3>
        <div id="admin-list" style="max-height:400px; overflow-y:auto; border:1px solid #ccc; padding:5px; background:#fff;"></div>
        <br>
        <p style="font-size:0.8rem; background:#ffffaa; padding:5px;">⚠️ IMPORTANTE: Descarga el archivo y súbelo a GitHub.</p>
        <button class="btn" style="width:100%; background:var(--brand-blue); color:#fff;" onclick="downloadJSON()">DESCARGAR PEDALES.JSON</button>
      </div>
    </div>
  </div>
</div>

<script>
  /* ================= CONFIGURACIÓN ================= */
  // URL DE GOOGLE FORMS
  const GFORM_URL = "https://docs.google.com/forms/d/e/TU_ID_AQUI/viewform";
  const GFORM_ENTRY = "entry.123456789";

  // SEGURIDAD (Hashes actuales: nagusi / admin)
  const HASH_SECRET = "8056214555075677813083110295627771746654160408542454559888927878"; 
  const HASH_PASS   = "8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918"; 

  /* ================= LÓGICA ================= */
  let allPedals = [];
  let selectedPedals = new Set();
  let keyBuffer = "";

  window.addEventListener('DOMContentLoaded', () => {
    fetchPedales();
    setupSecuritySimplified();
  });

  async function sha256(str) {
    const buf = new TextEncoder().encode(str);
    const hash = await crypto.subtle.digest('SHA-256', buf);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  // 1. CARGA
  async function fetchPedales() {
    try {
      const r = await fetch('pedales.json');
      allPedals = await r.json();
      renderCatalog();
      renderAdminList();
    } catch(e) { console.error(e); }
  }

  // 2. CATALOGO
  function renderCatalog() {
    const container = document.getElementById('pedal-container');
    container.innerHTML = "";
    
    const groups = {};
    allPedals.forEach(p => {
      const cat = p.categoria || 'otros';
      if(!groups[cat]) groups[cat] = [];
      groups[cat].push(p);
    });

    for(const cat in groups) {
      container.innerHTML += `<h2 style="border-bottom:4px solid var(--brand-blue); margin-top:3rem; color:var(--brand-blue);">// ${cat.toUpperCase()}</h2>`;
      const grid = document.createElement('div');
      grid.className = 'grid-pedales';

      groups[cat].forEach(p => {
        const rot = (Math.random() * 4 - 2).toFixed(1); 
        const isSel = selectedPedals.has(p.id);
        const mainImg = (p.imagenes && p.imagenes.length > 0) ? p.imagenes[0] : '';

        const card = document.createElement('div');
        card.className = 'card';
        card.style.setProperty('--rot', rot + 'deg');
        card.innerHTML = `
          <div class="card-img-wrapper" onclick="openModal('${p.id}')">
            <img src="${mainImg}" alt="${p.nombre}">
          </div>
          <h3 onclick="openModal('${p.id}')">${p.nombre}</h3>
          <p>${p.descripcionCorta}</p>
          <label class="checkbox-wrapper">
            <input type="checkbox" onchange="toggleSel('${p.id}', this)" ${isSel?'checked':''}>
            <span class="custom-check"></span>
            LO QUIERO
          </label>
        `;
        grid.appendChild(card);
      });
      container.appendChild(grid);
    }
  }

  // 3. CARRITO
  function toggleSel(id, chk) {
    if(chk.checked) selectedPedals.add(id); else selectedPedals.delete(id);
    updateFab();
  }
  function updateFab() {
    const fab = document.getElementById('cart-fab');
    const c = selectedPedals.size;
    fab.style.display = c > 0 ? 'block' : 'none';
    document.getElementById('cart-count').innerText = `${c} ITEM${c!==1?'S':''}`;
  }
  function checkout() {
    const items = allPedals.filter(p => selectedPedals.has(p.id)).map(p => `- ${p.nombre}`).join('\n');
    const url = `${GFORM_URL}?usp=pp_url&${GFORM_ENTRY}=${encodeURIComponent(items)}`;
    window.open(url, '_blank');
  }

  // 4. MODAL & VIDEO
  function openModal(id) {
    const p = allPedals.find(x => x.id === id);
    if(!p) return;
    
    document.getElementById('modal-title').innerText = p.nombre;
    document.getElementById('modal-cat').innerText = p.categoria;
    document.getElementById('modal-desc').innerText = p.descripcionLarga;
    
    const imgsContainer = document.getElementById('modal-imgs');
    imgsContainer.innerHTML = "";
    if(p.imagenes && p.imagenes.length > 0) {
      imgsContainer.innerHTML = p.imagenes.map(src => 
        `<img src="${src}" style="width:100%; border:2px solid var(--ink); box-shadow:5px 5px 0 rgba(0,0,0,0.1);">`
      ).join('');
    } else {
      imgsContainer.innerHTML = "<p>Sin imágenes</p>";
    }
    
    const vidCont = document.getElementById('modal-video-container');
    if(p.videoID) {
      vidCont.innerHTML = `<iframe class="video-frame" src="https://www.youtube.com/embed/${p.videoID}" allowfullscreen></iframe>`;
    } else {
      vidCont.innerHTML = "";
    }
    document.getElementById('product-modal').style.display = 'flex';
  }
  function closeModal() {
    document.getElementById('product-modal').style.display = 'none';
    document.getElementById('modal-video-container').innerHTML = ""; 
  }

  // 5. SEGURIDAD
  function setupSecuritySimplified() {
    window.addEventListener("keydown", async e => {
      keyBuffer += e.key.toLowerCase();
      if (keyBuffer.length > 50) keyBuffer = keyBuffer.slice(-50);
      if (keyBuffer.endsWith("nagusi")) {
        keyBuffer = "";
        setTimeout(async () => {
          const pass = prompt("PASSWORD ADMIN:");
          if (!pass) return;
          const h = await sha256(pass);
          if (h === HASH_PASS) {
            document.getElementById('admin-panel').style.display = 'block';
          } else {
            alert("ACCESO DENEGADO.");
          }
        }, 100);
      }
    });
  }

  function closeAdmin() {
    document.getElementById('admin-panel').style.display = 'none';
    renderCatalog();
  }

  // 6. ADMIN & IMAGENES
  async function generateHashTool() {
    const val = document.getElementById('new-pass-input').value;
    if(!val) return;
    const h = await sha256(val);
    const box = document.getElementById('hash-result');
    box.style.display = 'block';
    box.innerHTML = `HASH: ${h}`;
  }

  function savePedal() {
    const idField = document.getElementById('admin-id').value;
    const nombre = document.getElementById('admin-nombre').value;
    const id = idField || nombre.toLowerCase().replace(/ /g, '-').replace(/[^\w-]+/g, '');
    
    const imgsText = document.getElementById('admin-imgs-text').value;
    const imgsArray = imgsText.split('\n').map(url => url.trim()).filter(url => url !== "");

    const nuevo = {
      id,
      nombre,
      categoria: document.getElementById('admin-categoria').value,
      videoID: document.getElementById('admin-video').value,
      descripcionCorta: document.getElementById('admin-short').value,
      descripcionLarga: document.getElementById('admin-long').value,
      imagenes: imgsArray 
    };
    
    const idx = allPedals.findIndex(p => p.id === id);
    if(idx >= 0) allPedals[idx] = nuevo;
    else allPedals.push(nuevo);
    
    renderAdminList();
    alert("Guardado en memoria. Recuerda descargar el JSON.");
    clearForm();
  }

  function editPedal(id) {
    const p = allPedals.find(x => x.id === id);
    document.getElementById('admin-id').value = p.id;
    document.getElementById('admin-nombre').value = p.nombre;
    document.getElementById('admin-categoria').value = p.categoria;
    document.getElementById('admin-video').value = p.videoID || "";
    document.getElementById('admin-short').value = p.descripcionCorta;
    document.getElementById('admin-long').value = p.descripcionLarga;
    
    if(p.imagenes && Array.isArray(p.imagenes)) {
      document.getElementById('admin-imgs-text').value = p.imagenes.join('\n');
    } else {
      document.getElementById('admin-imgs-text').value = "";
    }
  }
  
  function deletePedal(id) {
    if(confirm("¿Eliminar?")) {
      allPedals = allPedals.filter(p => p.id !== id);
      renderAdminList();
    }
  }

  function renderAdminList() {
    document.getElementById('admin-list').innerHTML = allPedals.map(p => 
      `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #ddd; padding:5px;">
         <span>${p.nombre}</span>
         <div>
           <button onclick="editPedal('${p.id}')">EDIT</button>
           <button onclick="deletePedal('${p.id}')" style="color:red">X</button>
         </div>
       </div>`
    ).join('');
  }
  
  function clearForm() {
    document.querySelectorAll('#admin-panel input, #admin-panel textarea').forEach(i => i.value='');
  }

  function downloadJSON() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allPedals, null, 2));
    const a = document.createElement('a');
    a.href = dataStr; a.download = "pedales.json";
    a.click();
  }
</script>
</body>
</html>